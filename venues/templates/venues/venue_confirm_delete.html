{% extends 'base.html' %}
{% load static %}

{% block title %}Delete Venue - EventEase{% endblock %}

{% block content %}
<div class="container">
    <div class="delete-container">
        <div class="delete-header">
            <h1>üóëÔ∏è Delete Venue</h1>
            <div class="breadcrumb">
                <a href="{% url 'venues:venue_list' %}">Venues</a> > 
                <a href="{% url 'venues:venue_detail' venue.pk %}">{{ venue.name }}</a> > 
                Delete
            </div>
        </div>

        <div class="delete-content">
            <div class="warning-section">
                <div class="warning-icon">‚ö†Ô∏è</div>
                <div class="warning-text">
                    <h2>Are you sure you want to delete this venue?</h2>
                    <p>This action cannot be undone. The venue will be permanently removed from EventEase.</p>
                </div>
            </div>

            <div class="venue-summary">
                <h3>Venue to be deleted</h3>
                <div class="venue-info">
                    <div class="venue-image">
                        {% if venue.image %}
                            <img src="{{ venue.image.url }}" alt="{{ venue.name }}">
                        {% else %}
                            <div class="placeholder-image">
                                <span>üè¢</span>
                            </div>
                        {% endif %}
                    </div>
                    <div class="venue-details">
                        <h4>{{ venue.name }}</h4>
                        <p><strong>Type:</strong> {{ venue.get_venue_type_display }}</p>
                        <p><strong>Capacity:</strong> {{ venue.capacity }} people</p>
                        <p><strong>Location:</strong> {{ venue.address }}, {{ venue.city }}</p>
                        <p><strong>Manager:</strong> {{ venue.manager.get_full_name }}</p>
                        {% if venue.hourly_rate %}
                            <p><strong>Hourly Rate:</strong> ${{ venue.hourly_rate }}</p>
                        {% endif %}
                        {% if venue.daily_rate %}
                            <p><strong>Daily Rate:</strong> ${{ venue.daily_rate }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Check for active bookings -->
            {% if has_active_bookings %}
                <div class="impact-warning">
                    <h3>‚ö†Ô∏è Warning: Active Bookings Found</h3>
                    <div class="booking-notice">
                        <p><strong>This venue has {{ active_bookings_count }} active booking(s).</strong></p>
                        <p>Deleting this venue will affect the following:</p>
                        <ul>
                            <li>All pending and confirmed bookings will be cancelled</li>
                            <li>Event organizers will need to find alternative venues</li>
                            <li>Customers may need to be refunded</li>
                        </ul>
                        <div class="recommendation">
                            <p><strong>Recommendation:</strong> Consider marking the venue as "unavailable" instead of deleting it, 
                            or contact the event organizers to arrange alternative arrangements first.</p>
                        </div>
                    </div>
                </div>
            {% endif %}

            <!-- Check for associated events -->
            {% if has_events %}
                <div class="impact-warning">
                    <h3>üìÖ Associated Events</h3>
                    <div class="events-notice">
                        <p><strong>This venue is associated with {{ events_count }} event(s).</strong></p>
                        <p>These events may be affected by deleting this venue:</p>
                        <ul>
                            {% for event in associated_events|slice:":5" %}
                                <li>{{ event.title }} - {{ event.start_date|date:"M d, Y" }}</li>
                            {% endfor %}
                            {% if events_count > 5 %}
                                <li>... and {{ events_count|add:"-5" }} more events</li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            {% endif %}

            <div class="impact-notice">
                <h3>What happens when you delete this venue?</h3>
                <ul>
                    <li>The venue will be permanently removed from EventEase</li>
                    <li>All venue information, photos, and details will be lost</li>
                    <li>The venue will no longer appear in search results or listings</li>
                    <li>Any pending bookings will be automatically cancelled</li>
                    <li>Event organizers using this venue will need to find alternatives</li>
                    <li>This action cannot be undone</li>
                </ul>
            </div>

            <form method="post" class="delete-form">
                {% csrf_token %}
                {% if has_active_bookings or has_events %}
                    <div class="confirmation-checkbox">
                        <input type="checkbox" id="confirm-impact" name="confirm_impact" required>
                        <label for="confirm-impact">
                            I understand that this venue has active bookings/events and I want to proceed with deletion anyway
                        </label>
                    </div>
                {% endif %}
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-danger btn-large" 
                            {% if has_active_bookings or has_events %}onclick="return confirm('Are you absolutely sure? This will affect active bookings and events!')"{% endif %}>
                        Yes, Delete Venue Permanently
                    </button>
                    <a href="{% url 'venues:venue_detail' venue.pk %}" class="btn btn-secondary btn-large">
                        Cancel - Keep Venue
                    </a>
                </div>
            </form>

            {% if has_active_bookings or has_events %}
                <div class="alternative-actions">
                    <h3>Alternative Actions</h3>
                    <p>Instead of deleting, you might want to:</p>
                    <div class="action-buttons">
                        <a href="{% url 'venues:venue_edit' venue.pk %}" class="btn btn-warning">
                            üìù Mark as Unavailable
                        </a>
                        <a href="{% url 'venues:my_bookings' %}" class="btn btn-info">
                            üìã Manage Bookings First
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.container {
    max-width: 700px;
    margin: 0 auto;
    padding: 2rem;
}

.delete-container {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(220, 53, 69, 0.1);
    overflow: hidden;
}

.delete-header {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    color: white;
    padding: 2rem;
    text-align: center;
}

.delete-header h1 {
    margin: 0 0 0.5rem 0;
    font-size: 2rem;
}

.breadcrumb {
    opacity: 0.9;
    margin-top: 0.5rem;
}

.breadcrumb a {
    color: white;
    text-decoration: none;
}

.delete-content {
    padding: 2rem;
}

.warning-section {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
    background: #fff5f5;
    border: 2px solid #fed7d7;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.warning-icon {
    font-size: 2rem;
    color: #dc3545;
}

.warning-text h2 {
    color: #dc3545;
    margin: 0 0 0.5rem 0;
    font-size: 1.3rem;
}

.warning-text p {
    color: #333;
    margin: 0;
    line-height: 1.5;
}

.venue-summary {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.venue-summary h3 {
    color: #333;
    margin: 0 0 1rem 0;
    font-size: 1.2rem;
}

.venue-info {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
}

.venue-image {
    width: 100px;
    height: 100px;
    border-radius: 8px;
    overflow: hidden;
    flex-shrink: 0;
}

.venue-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.placeholder-image {
    width: 100%;
    height: 100%;
    background: #e1e8ed;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    color: #666;
}

.venue-details h4 {
    color: #40B5AD;
    margin: 0 0 0.5rem 0;
    font-size: 1.2rem;
}

.venue-details p {
    margin: 0.25rem 0;
    color: #666;
    font-size: 0.95rem;
}

.impact-warning {
    background: #fff3cd;
    border: 2px solid #ffc107;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.impact-warning h3 {
    color: #856404;
    margin: 0 0 1rem 0;
    font-size: 1.2rem;
}

.booking-notice, .events-notice {
    color: #333;
}

.booking-notice p, .events-notice p {
    margin: 0.5rem 0;
    line-height: 1.5;
}

.booking-notice ul, .events-notice ul {
    margin: 0.5rem 0;
    padding-left: 1.5rem;
}

.booking-notice li, .events-notice li {
    margin: 0.25rem 0;
}

.recommendation {
    background: #d4edda;
    border-left: 4px solid #28a745;
    padding: 1rem;
    margin-top: 1rem;
    border-radius: 0 4px 4px 0;
}

.impact-notice {
    background: #e3f2fd;
    border: 1px solid #40B5AD;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.impact-notice h3 {
    color: #40B5AD;
    margin: 0 0 1rem 0;
    font-size: 1.1rem;
}

.impact-notice ul {
    margin: 0;
    padding-left: 1.5rem;
    color: #333;
}

.impact-notice li {
    margin: 0.5rem 0;
    line-height: 1.4;
}

.delete-form {
    border-top: 1px solid #e1e8ed;
    padding-top: 2rem;
}

.confirmation-checkbox {
    background: #fff3cd;
    border: 2px solid #ffc107;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 2rem;
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
}

.confirmation-checkbox input[type="checkbox"] {
    margin-top: 0.25rem;
    transform: scale(1.2);
}

.confirmation-checkbox label {
    color: #856404;
    font-weight: 600;
    line-height: 1.4;
    cursor: pointer;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-bottom: 2rem;
}

.btn-large {
    padding: 1rem 2rem;
    font-size: 1.1rem;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none;
    display: inline-block;
    text-align: center;
    border: none;
    cursor: pointer;
    transition: background-color 0.2s;
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn-danger:hover {
    background: #c82333;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #545b62;
}

.alternative-actions {
    background: #e8f5e8;
    border: 1px solid #27ae60;
    border-radius: 8px;
    padding: 1.5rem;
    text-align: center;
}

.alternative-actions h3 {
    color: #27ae60;
    margin: 0 0 1rem 0;
    font-size: 1.1rem;
}

.alternative-actions p {
    color: #333;
    margin: 0 0 1rem 0;
}

.action-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

.btn-warning {
    background: #ffc107;
    color: #212529;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: background-color 0.2s;
}

.btn-warning:hover {
    background: #e0a800;
}

.btn-info {
    background: #17a2b8;
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: background-color 0.2s;
}

.btn-info:hover {
    background: #138496;
}

@media (max-width: 768px) {
    .warning-section {
        flex-direction: column;
        text-align: center;
    }
    
    .venue-info {
        flex-direction: column;
        text-align: center;
    }
    
    .form-actions, .action-buttons {
        flex-direction: column;
    }
    
    .form-actions .btn, .action-buttons .btn {
        width: 100%;
    }
    
    .confirmation-checkbox {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .confirmation-checkbox input[type="checkbox"] {
        margin-top: 0;
    }
}
</style>
{% endblock %}
